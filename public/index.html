<!DOCTYPE html>
<html>
  <head>
    <title>Autorennen</title>
    <style>
      canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <div id="gameContainer">
      <canvas
        id="gameCanvas"
        width="800"
        height="600"
        style="display: none"
      ></canvas>
    </div>
    <script>
      const canvas = document.getElementById("gameCanvas");
      const context = canvas.getContext("2d");

      const carWidth = 40;
      const carHeight = 20;
      const carSpeed = 5;

      let redCar = {
        x: 50,
        y: canvas.height / 2 - carHeight / 2,
        color: "red",
        dx: 0,
        dy: 0,
      };

      let blueCar = {
        x: canvas.width - 50 - carWidth,
        y: canvas.height / 2 - carHeight / 2,
        color: "blue",
        dx: 0,
        dy: 0,
      };

      // WebSocket-Verbindung herstellen
      const socket = new WebSocket("ws://localhost:3000");

      socket.addEventListener("open", function () {
        console.log("WebSocket-Verbindung hergestellt");
      });

      socket.addEventListener("message", function (event) {
        const data = JSON.parse(event.data);
        if (data.car === "red") {
          redCar.dx = data.dx || 0;
          redCar.dy = data.dy || 0;
        } else if (data.car === "blue") {
          blueCar.dx = data.dx || 0;
          blueCar.dy = data.dy || 0;
        }
      });

      function drawCar(car) {
        context.fillStyle = car.color;
        context.fillRect(car.x, car.y, carWidth, carHeight);
      }

      document.addEventListener("keydown", function (event) {
        if (event.key === "w") {
          redCar.dy = -carSpeed;
          socket.send(JSON.stringify({ car: "red", dy: -carSpeed }));
        } else if (event.key === "s") {
          redCar.dy = carSpeed;
          socket.send(JSON.stringify({ car: "red", dy: carSpeed }));
        } else if (event.key === "a") {
          redCar.dx = -carSpeed;
          socket.send(JSON.stringify({ car: "red", dx: -carSpeed }));
        } else if (event.key === "d") {
          redCar.dx = carSpeed;
          socket.send(JSON.stringify({ car: "red", dx: carSpeed }));
        } else if (event.key === "ArrowUp") {
          blueCar.dy = -carSpeed;
          socket.send(JSON.stringify({ car: "blue", dy: -carSpeed }));
        } else if (event.key === "ArrowDown") {
          blueCar.dy = carSpeed;
          socket.send(JSON.stringify({ car: "blue", dy: carSpeed }));
        } else if (event.key === "ArrowLeft") {
          blueCar.dx = -carSpeed;
          socket.send(JSON.stringify({ car: "blue", dx: -carSpeed }));
        } else if (event.key === "ArrowRight") {
          blueCar.dx = carSpeed;
          socket.send(JSON.stringify({ car: "blue", dx: carSpeed }));
        }
      });

      document.addEventListener("keyup", function (event) {
        if (event.key === "w" || event.key === "s") {
          redCar.dy = 0;
          socket.send(JSON.stringify({ car: "red", dy: 0 }));
        } else if (event.key === "a" || event.key === "d") {
          redCar.dx = 0;
          socket.send(JSON.stringify({ car: "red", dx: 0 }));
        } else if (event.key === "ArrowUp" || event.key === "ArrowDown") {
          blueCar.dy = 0;
          socket.send(JSON.stringify({ car: "blue", dy: 0 }));
        } else if (event.key === "ArrowLeft" || event.key === "ArrowRight") {
          blueCar.dx = 0;
          socket.send(JSON.stringify({ car: "blue", dx: 0 }));
        }
      });

      function update() {
        context.clearRect(0, 0, canvas.width, canvas.height);

        redCar.x += redCar.dx;
        redCar.y += redCar.dy;

        blueCar.x += blueCar.dx;
        blueCar.y += blueCar.dy;

        drawCar(redCar);
        drawCar(blueCar);

        requestAnimationFrame(update);
      }

      update();
    </script>
  </body>
</html>
